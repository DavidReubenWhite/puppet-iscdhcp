<%- if @shared_network -%>
  subnet <%=@title.split('/')[0]%> netmask <%= IPAddr.new(@title).inspect.gsub(/.*\/([0-9.]+).*/,'\1')%> {
  <%- if defined?(@authoritative) -%>
    <%- if @authoritative == true -%>
    authoritative;
    <%- else -%>
    not authoritative;
    <%-end-%>
  <%-end-%>
  <%- if defined?(@options) -%>
    <%- @options.each do | option, value | -%>
      <%- if value.kind_of?(Array) -%>
    option <%= option %> <%= value.join(', ') %>;
      <%-else-%>
        <%-if value -%>
    option <%= option %> <%= value %>;
        <%-end-%>
      <%-end-%>
    <%-end-%>
  <%-end-%>
  <%- if defined?(@parameters) -%>
    <%- @parameters.each do | parameter, value | -%>
      <%- if value -%>
        <%- if parameter == 'pools' -%>
          <%- value.each do | pool | -%>
    pool {
            <%- if pool.has_key? "failover_peer" -%>
      failover_peer "<%= pool['failover_peer'] %>";
            <%-end-%>
      range-start <%= pool['range_start'] %>;
      range-end <%= pool['range_end'] %>;
    }
          <%-end-%>
        <%-else-%>
    <%= parameter %> <%= value %>;
        <%-end-%>
      <%-end-%>
    <%-end-%>
  <%-end-%>
  <%- if defined?(@hosts) -%>
    <%- @hosts.each do | host, value | -%>
    host <%= host %> {
      <%- if value.has_key? "parameters" -%>
        <%- value['parameters'].each do | parameter, value | -%>
          <%- if parameter == 'host-identifier' -%>
      host-identifier option <%= value['option'] %> "<%= value['value'] %>";
          <%-else-%>
      <%= parameter %> <%= value %>;
          <%-end-%>
        <%-end-%>
      <%-end-%>
      <%- if value.has_key? "options" -%>
        <%- value['options'].each do | option, value | -%>
      <%= option %> <%= value %>;
        <%-end-%>
      <%-end-%>
    }
    <%-end-%>
  <%-end-%>
  }
<%-else-%>
subnet <%=@title.split('/')[0]%> netmask <%= IPAddr.new(@title).inspect.gsub(/.*\/([0-9.]+).*/,'\1')%> {
  <%- if defined?(@authoritative) -%>
    <%- if @authoritative == true -%>
  authoritative;
    <%- else -%>
  not authoritative;
    <%-end-%>
  <%-end-%>
  <%- if defined?(@options) -%>
    <%- @options.each do | option, value | -%>
      <%- if value.kind_of?(Array) -%>
  option <%= option %> <%=value.join(', ')%>;
      <%-else-%>
        <%-if value -%>
  option <%= option %> <%= value %>;
        <%-end-%>
      <%-end-%>
    <%-end-%>
  <%-end-%>
  <%- if defined?(@parameters) -%>
    <%- @parameters.each do | parameter, value | -%>
      <%- if value -%>
        <%- if parameter == 'pools' -%>
          <%- value.each do | pool | -%>
  pool {
            <%- if pool.has_key? "failover_peer" -%>
    failover_peer "<%= pool['failover_peer'] %>";
            <%-end-%>
    range-start <%= pool['range_start'] %>;
    range-end <%= pool['range_end'] %>;
  }
          <%-end-%>
        <%-else-%>
  <%= parameter %> <%= value %>;
        <%-end-%>
      <%-end-%>
    <%-end-%>
  <%-end-%>
  <%- if defined?(@hosts) -%>
    <%- @hosts.each do | host, value | -%>
  host <%= host %> {
      <%- if value.has_key? "parameters" -%>
        <%- value['parameters'].each do | parameter, value | -%>
          <%- if parameter == 'host-identifier' -%>
    host-identifier option <%= value['option'] %> "<%= value['value'] %>";
          <%-else-%>
    <%= parameter %> <%= value %>;
          <%-end-%>
        <%-end-%>
      <%-end-%>
      <%- if value.has_key? "options" -%>
        <%- value['options'].each do | option, value | -%>
    <%= option %> <%= value %>;
        <%-end-%>
      <%-end-%>
  }
    <%-end-%>
  <%-end-%>
}
<%-end-%>
